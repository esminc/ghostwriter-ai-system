# 代筆さん機能 要件定義書（最終版）

## 1. 機能概要

### 機能名
**代筆さん (Ghostwriter for esa Diary)**

### 目的
- チームメンバーの日記投稿負担を軽減
- 継続的な日記文化の維持支援
- 個人の文体・スタイルを学習した高品質な代筆投稿の実現

### 対象ユーザー
- ESM ITS チームメンバー全員（Slack利用者）

## 2. 開発スコープ

### 含まれる機能（Phase 1-2）
- ✅ Phase 1: Claude Desktop + MCP Server（技術検証用）
- ✅ Phase 2: Slack Bot（メイン機能・チーム展開用）

### 除外する機能
- ❌ Web UI（将来的な拡張として検討）
- ❌ Mobile専用アプリ（将来的な拡張として検討）
- ❌ 複雑な権限管理システム（シンプルな運用ルールで代替）

## 3. 機能仕様

### 3.1 基本フロー
```
1. Slack Bot呼び出し → 2. プロファイル分析 → 3. 行動入力 → 4. 日記生成 → 5. esa投稿
```

### 3.2 Slack Bot インターフェース

#### A. 基本コマンド
```
# 代筆依頼
@代筆さん [ユーザー名]の代筆お願いします
@代筆さん okamoto-takuyaの代筆お願いします

# 行動入力（続けて入力）
今日の行動:
・バグ修正作業
・新人のコードレビュー  
・MCP勉強

# おまかせ生成
@代筆さん okamoto-takuyaの代筆お願いします（おまかせ）
```

#### B. 対話フロー
```
1. 👤「@代筆さん okamoto-takuyaの代筆お願いします」
   🤖「承知しました！okamoto-takuyaさんのプロファイル分析中...」
   🤖「過去87件の記事を分析完了しました」

2. 🤖「今日の行動を教えてください」
   🤖「『おまかせ』と入力すると自動生成します」
   👤「・バグ修正 ・コードレビュー ・MCP勉強」

3. 🤖「日記を生成中...」
   🤖「以下の内容で投稿します（30秒でタイムアウト）」
   [生成された日記をプレビュー表示]
   👤「👍」（リアクションで承認）

4. 🤖「esa記事を投稿しました！」
   🤖「📝 [【代筆】okamoto-takuya:バグと格闘した日](https://esminc-its.esa.io/posts/xxx)」
```

### 3.3 プロファイル分析機能

#### 入力・処理
- 対象ユーザー名でesa記事を検索
- 直近50-100件の日記記事を分析
- 文体、語調、よく使う表現の抽出
- 技術的関心、行動パターンの学習
- 結果をJSONでキャッシュ（24時間有効）

#### 出力
- 文体スタイル情報
- 関心事・技術領域
- 日記フォーマット情報

### 3.4 日記生成機能

#### 生成要素
```
タイトル: 【代筆】{ユーザー名}:{日記タイトル}
本文:
## やることやったこと
- [x] 入力された行動を「その人らしく」表現

## TIL
- その人の関心事に関連した学習内容

## こんな気分
- その人らしい感情表現
```

#### 生成品質
- 対象ユーザーの文体を80%以上再現
- リアリティのある内容（明確な嘘は避ける）
- 過去の投稿との一貫性を保つ

### 3.5 esa投稿機能

#### 投稿仕様
- カテゴリ: `日記/{YYYY}/{MM}/{DD}/`
- 記事種別: flow
- タイトルに【代筆】を必須付与
- 投稿者: Botアカウント（代筆者明記）

## 4. 技術要件

### 4.1 アーキテクチャ
```
[Slack Bot] → [代筆サービス] → [esa API]
            ↗                 ↗
[Claude Desktop + MCP] ------↗
```

### 4.2 使用技術
- **Slack Bot**: Slack API、Bolt framework
- **代筆サービス**: Node.js、Express
- **AI**: OpenAI GPT-4 API
- **データ保存**: JSON ファイル or 軽量DB（SQLite）
- **esa連携**: esa API v1

### 4.3 性能要件
- プロファイル分析: 初回3分以内、キャッシュ利用時30秒以内
- 日記生成: 1分以内
- Slack応答: 30秒以内（生成中の中間メッセージで体験向上）

## 5. 運用要件

### 5.1 権限・制限
- **利用者制限**: ITSチームメンバーのみ
- **頻度制限**: 1人あたり週3回まで
- **代筆対象**: 原則として自分 + チームメンバー
- **承認フロー**: Slackリアクションでの簡易承認

### 5.2 品質管理
- 【代筆】タグ必須
- 不適切内容の自動フィルタリング
- 30秒以内の承認タイムアウト（自動キャンセル）

### 5.3 エラーハンドリング
```
・esa API エラー → Slackで通知、リトライ案内
・プロファイル分析失敗 → 汎用テンプレート使用
・生成タイムアウト → 「少し時間をおいて再試行してください」
・投稿失敗 → 生成内容を保持してリトライ
```

## 6. 開発・展開計画

### Phase 1: MCP Server（技術検証）
**期間**: 2週間
- プロファイル分析機能の実装
- 基本的な日記生成機能
- Claude Desktop での動作確認

**成果物**:
- MCPサーバー実装
- okamoto-takuyaでの動作検証
- 生成品質の初期評価

### Phase 2: Slack Bot（本格展開）
**期間**: 3週間
- Slack Bot 実装
- esa API連携
- エラーハンドリング実装
- チーム内βテスト

**成果物**:
- Slack Bot サービス
- 運用ドキュメント
- チーム全体での利用開始

## 7. 成功指標

### 7.1 利用指標
- **利用率**: チームメンバーの60%以上が月1回利用
- **継続率**: 初回利用から1ヶ月後の再利用率50%以上
- **品質評価**: 生成記事の平均評価4.0/5.0以上

### 7.2 効果指標
- **日記投稿率**: チーム全体の日記投稿頻度10%向上
- **負担軽減**: 日記作成時間の30%短縮（自己申告）
- **文化維持**: 日記制度の継続率向上

## 8. リスク・制約

### 8.1 技術リスク
- **AI生成品質**: プロンプトエンジニアリングで対応
- **API制限**: esa API率制限（キャッシュ戦略で対応）

### 8.2 運用リスク
- **悪用防止**: 頻度制限・内容フィルタで対応
- **文化への影響**: 代筆と本物のバランス保持

### 8.3 対策
- 週1回の利用統計レビュー
- 月1回のチーム内フィードバック収集
- 品質改善の継続的実施

---

## 次のステップ
1. **Phase 1実装**: MCPサーバー開発開始
2. **技術検証**: okamoto-takuyaでの動作テスト
3. **Phase 2設計**: Slack Bot詳細設計
4. **βテスト準備**: チーム内テスト計画策定